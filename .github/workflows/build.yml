name: CI
on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/setup-node@v3
            - name: Checkout sources
              uses: actions/checkout@v2
              with:
                  persist-credentials: false

            - name: FixForNodeWarnings
              run: |
                  echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p

            - name: Build
              run: |
                  npm install
                  npm run lint
                  npm run test
                  npm run build
            
            - name: Check License Header
              uses: apache/skywalking-eyes/header@main      # always prefer to use a revision instead of `main`.
              # with:
                  # log: debug # optional: set the log level. The default value is `info`.
                  # config: .licenserc.yaml # optional: set the config file. The default value is `.licenserc.yaml`.
                  # token: # optional: the token that license eye uses when it needs to comment on the pull request. Set to empty ("") to disable commenting on pull request. The default value is ${{ github.token }}
                  # mode: # optional: Which mode License-Eye should be run in. Choices are `check` or `fix`. The default value is `check`.

            - name: Check Dependencies' License
              uses: apache/skywalking-eyes/dependency@main      # always prefer to use a revision instead of `main`.
              # with:
                  # log: debug # optional: set the log level. The default value is `info`.
                  # config: .licenserc.yaml # optional: set the config file. The default value is `.licenserc.yaml`.
                  # mode: # optional: Which mode License-Eye should be run in. Choices are `check` or `resolve`. The default value is `check`.
                  # flags: # optional: Extra flags appended to the command, for example, `--summary=path/to/template.tmpl`
